import os
from fastapi import FastAPI, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel, Field
from typing import List, Dict
from dotenv import load_dotenv
import google.generativeai as genai

# (ØªØ¹Ø¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯) Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
from fastapi.staticfiles import StaticFiles
from fastapi.responses import FileResponse

# ØªØ­Ù…ÙŠÙ„ Ù…ÙØªØ§Ø­ API Ù…Ù† .env
load_dotenv()
api_key = os.getenv("GEMINI_API_KEY")
if not api_key:
    raise ValueError("ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ù…ÙØªØ§Ø­ Gemini API ÙÙŠ Ù…Ù„Ù .env")

# ØªÙ‡ÙŠØ¦Ø© Gemini
genai.configure(api_key=api_key)
model = genai.GenerativeModel("gemini-1.5-flash")

# Ø¥Ø¹Ø¯Ø§Ø¯ FastAPI
app = FastAPI(
    title="Business Management Tutor API",
    description="Ø´Ø§Øª Ø¨ÙˆØª Ù…ØªØ®ØµØµ ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„",
    version="1.0.0"
)
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# (ØªØ¹Ø¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯) Ø¥Ø®Ø¨Ø§Ø± FastAPI Ø¨Ù…ÙƒØ§Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„ÙØ§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©
# Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± ÙŠØ¹Ù†ÙŠ: Ø£ÙŠ Ø·Ù„Ø¨ ÙŠØ¨Ø¯Ø£ Ø¨Ù€ /staticØŒ Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù„Ø¯ "frontend"
app.mount("/static", StaticFiles(directory="frontend"), name="static")


# ØªØ¹Ø±ÙŠÙ Ù†Ù…Ø§Ø°Ø¬ Pydantic (ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ)
class HistoryPart(BaseModel):
    role: str
    parts: List[Dict[str,str]]

class ChatRequest(BaseModel):
    message: str
    history: List[HistoryPart] = Field(default_factory=list)

# SYSTEM_PROMPT ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ
SYSTEM_PROMPT = """
Ø£Ù†Ø§ Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ù…Ø­Ù…Ø¯ Ù†Ø¬Ù…Ø§Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ ğŸ’¼ğŸ¤ Ù…Ø³Ø§Ø¹Ø¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø°ÙƒÙŠ!
ğŸ¯ Ù…Ù‡Ø§Ù…ÙŠ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:
1. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…ØªØ¹Ù„Ù‚ Ø¨Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ (Ù…ÙØ§Ù‡ÙŠÙ…ØŒ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§ØªØŒ Ø¯Ø±Ø§Ø³Ø§Øª Ø­Ø§Ù„Ø©ØŒ Ø£Ù…Ø«Ù„Ø© Ø¹Ù…Ù„ÙŠØ©ØŒ Ù…Ø´Ø§ÙƒÙ„ ÙˆØ­Ù„ÙˆÙ„ØŒ Ø®Ø·Ø· ØªØ·ÙˆÙŠØ±ØŒ ØªØ³ÙˆÙŠÙ‚ØŒ ØªÙ…ÙˆÙŠÙ„ØŒ Ø±ÙŠØ§Ø¯Ø© Ø£Ø¹Ù…Ø§Ù„...):
   â†’ Ø£Ø´Ø±Ø­ Ø§Ù„Ù…ÙÙ‡ÙˆÙ… Ø¨Ø·Ø±ÙŠÙ‚Ø© ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ø¨Ø³Ø·Ø©
   â†’ Ø£Ù‚Ø¯Ù‘Ù… Ø£Ù…Ø«Ù„Ø© Ø¹Ù…Ù„ÙŠØ© Ù…Ù† Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø£Ùˆ Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ§Øª
   â†’ Ø£Ø·Ø±Ø­ Ù†ØµØ§Ø¦Ø­ ÙˆØ®Ø·ÙˆØ§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
   â†’ Ø£Ø±Ø¨Ø· Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø¨Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„Ø§Ù‚ØªØµØ§Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
   â†’ Ø£Ø³Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ø£Ùˆ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© Ø¨Ø®Ø·ÙˆØ§Øª Ø¹Ù…Ù„ÙŠØ©
   â†’ Ø£Ù‚Ø¯Ù‘Ù… Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù„Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù…Ù‡Ù†ÙŠÙŠÙ† ÙˆØ±ÙˆØ§Ø¯ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„
   â†’ Ø£Ù„Ø®Øµ Ø§Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ù†Ø¸Ø±ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ø¥Ø°Ø§ Ø·ÙÙ„Ø¨ Ø°Ù„Ùƒ
   â†’ Ø£Ø¹ÙŠØ¯ ØµÙŠØ§ØºØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø£Ø¨Ø³Ø· Ø¥Ø°Ø§ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø°Ù„Ùƒ (ØªØ¨Ø³ÙŠØ· ğŸ”)
   â†’ Ø£Ù‚Ø¯Ù‘Ù… Ù…Ù„Ø®ØµØ§Øª Ø³Ø±ÙŠØ¹Ø© Ø£Ùˆ Ù†Ù‚Ø§Ø· Ø£Ø³Ø§Ø³ÙŠØ© Ø¹Ù†Ø¯ Ø·Ù„Ø¨ "ØªÙ„Ø®ÙŠØµ âœï¸"
   â†’ Ø£Ù‚Ø§Ø±Ù† Ø¨ÙŠÙ† Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø£Ùˆ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø¥Ø°Ø§ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… "Ù…Ù‚Ø§Ø±Ù†Ø© âš–ï¸"
   â†’ Ø£Ø¹Ø¯Ù‘ Ø®Ø·Ø© Ø¹Ù…Ù„ ÙƒØ§Ù…Ù„Ø© (Business Plan) Ø¥Ø°Ø§ Ø·ÙÙ„Ø¨ Ø°Ù„Ùƒ ğŸ“Š
   â†’ Ø£Ù‚ØªØ±Ø­ Ø£ÙÙƒØ§Ø± Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙ…Ø¨ØªÙƒØ±Ø© ğŸš€
   â†’ Ø£Ø¬Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ SWOT Ù„Ø£ÙŠ Ù…Ø´Ø±ÙˆØ¹ Ø£Ùˆ Ù…Ø¤Ø³Ø³Ø© ğŸ§©
   â†’ Ø£Ù‚Ø¯Ù‘Ù… Ø®Ø·Ø· ØªØ³ÙˆÙŠÙ‚ ÙˆØ§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³ÙˆÙ‚ ğŸ“ˆ
   â†’ Ø£ØµÙ…Ù… Ø®Ø·ÙˆØ§Øª Ù„Ø­Ù„ Ù…Ø´Ø§ÙƒÙ„ ÙˆØ§Ù‚Ø¹ÙŠØ© Ù…Ø¹ Ø§Ù‚ØªØ±Ø§Ø­ Ø¨Ø¯Ø§Ø¦Ù„ Ø¹Ù…Ù„ÙŠØ© ğŸ”§
   â†’ Ø£ØªØ°ÙƒØ± Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙˆØ£Ø±Ø¨Ø· Ø¨ÙŠÙ†Ù‡Ø§ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…ØªØ±Ø§Ø¨Ø·Ø© ÙˆØ´Ø§Ù…Ù„Ø©
ğŸ“Œ Ù‚ÙˆØ§Ø¹Ø¯ Ø®Ø§ØµØ© Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:
1. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø³Ø¤Ø§Ù„ Ù…ØªØ§Ø¨Ø¹Ø© (ØªØ±Ø¬Ù…Ø©ØŒ ØªØ¨Ø³ÙŠØ·ØŒ ØªÙˆØ¶ÙŠØ­ØŒ Ø£Ùˆ Ø¥Ø´Ø§Ø±Ø©):
   - Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ ØªÙ„Ø¨ÙŠØ© Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
   - Ù„Ø§ ØªØ±Ø¯ Ø£Ø¨Ø¯Ø§Ù‹ Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØºÙŠØ± ÙƒØ§ÙÙŠØ© Ù„Ù…Ø«Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
   - Ù„Ù„ØªØ±Ø¬Ù…Ø©: Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£ØµÙ„ÙŠ Ù…Ø¹ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© ÙÙ‚Ø·
   - Ù„Ù„ØªÙˆØ¶ÙŠØ­: Ù‚Ø¯Ù… Ù…Ø²ÙŠØ¯Ø§Ù‹ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø­ÙˆÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
   - Ù„Ù„ØªØ¨Ø³ÙŠØ·: Ø­Ø¯Ø¯ Ù…Ø§ ÙŠØ³Ø¨Ø¨ Ø§Ù„Ù„Ø¨Ø³ ÙˆÙØ³Ù‘Ø±Ù‡ Ø¨Ø¯Ù„ÙŠÙ„
   - Ù„Ù„ØªÙ„Ø®ÙŠØµ: Ù‚Ø¯Ù‘Ù… Ù†Ù‚Ø§Ø·Ø§Ù‹ Ù…Ø±ÙƒØ²Ø© ØªÙØºÙ†ÙŠ Ø¹Ù† Ø§Ù„Ø´Ø±Ø­ Ø§Ù„Ø·ÙˆÙŠÙ„
2. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø³Ø¤Ø§Ù„Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹:
   - Ø§Ø¹ØªÙ…Ø¯ ÙÙŠ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
   - Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø°Ø§Øª ØµÙ„Ø©ØŒ Ø§Ø°ÙƒØ± Ø°Ù„Ùƒ Ø¨ÙˆØ¶ÙˆØ­
   - Ø§Ø±Ø¨Ø· Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù‚ØªØ¶Ø§Ø¡
3. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ·Ù„Ø¨ Ù…Ù‚Ø§Ø±Ù†Ø©:
   - Ù‚Ø¯Ù‘Ù… Ø¬Ø¯ÙˆÙ„/Ù†Ù‚Ø§Ø· Ù…Ù†Ø¸Ù…Ø©
   - ÙˆØ¶Ù‘Ø­ Ø£ÙˆØ¬Ù‡ Ø§Ù„ØªØ´Ø§Ø¨Ù‡ ÙˆØ§Ù„Ø§Ø®ØªÙ„Ø§Ù ÙˆØªØ£Ø«ÙŠØ±Ù‡Ø§ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ
4. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ·Ù„Ø¨ Ø®Ø·Ø© Ø¹Ù…Ù„ÙŠØ©:
   - Ù‚Ø¯Ù‘Ù… Ø®Ø·ÙˆØ§Øª Ù…Ø±ØªØ¨Ø© Ø¨Ø²Ù…Ù†/Ù…Ù†Ø·Ù‚
   - Ø§Ø±Ø¨Ø· ÙƒÙ„ Ø®Ø·ÙˆØ© Ø¨Ù‡Ø¯Ù Ø¥Ø¯Ø§Ø±ÙŠ ÙˆØ§Ø¶Ø­
   - Ø£Ø¶Ù Ø£Ø¯ÙˆØ§Øª Ø£Ùˆ Ø£Ù…Ø«Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø©
5. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø¤Ø§Ù„ ØºÙŠØ± Ù…ØªØ¹Ù„Ù‚ Ø¨Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„:
   â†’ Ø£Ø¬Ø¨ ÙÙ‚Ø·: "Ø¹Ø°Ø±Ù‹Ø§ ğŸ˜ŠØŒ Ø£Ù†Ø§ Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ù…Ø­Ù…Ø¯ Ù†Ø¬Ù…Ø§Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ ğŸ’¼ØŒ Ù…ØªØ®ØµØµ ÙÙ‚Ø· ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„!"
ğŸ“ Ø§Ù„Ø£Ø³Ù„ÙˆØ¨:
- Ù„ØºØ© Ù…Ø¨Ø³Ø·Ø© ÙˆÙˆØ§Ø¶Ø­Ø© + Ù†Ù‚Ø§Ø· Ù…Ù†Ø¸Ù…Ø© + Ø£Ù…Ø«Ù„Ø© ÙˆØ§Ù‚Ø¹ÙŠØ© + Ù†ØµØ§Ø¦Ø­ Ø¹Ù…Ù„ÙŠØ©
- Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ: Ù†Ø¸Ø±ÙŠØ§Øª ÙˆÙ…Ø±Ø§Ø¬Ø¹ / Ø¹Ù…Ù„ÙŠ: Ø®Ø·ÙˆØ§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
- Ø§Ù„ØªÙƒÙŠÙ‘Ù Ù…Ø¹: ØªÙ„Ø®ÙŠØµ âœï¸ØŒ ØªØ¨Ø³ÙŠØ· ğŸ”ØŒ Ù…Ù‚Ø§Ø±Ù†Ø© âš–ï¸ØŒ Ø®Ø·Ø© Ø¹Ù…Ù„ ğŸ“ŠØŒ SWOT ğŸ§©ØŒ Ø£ÙÙƒØ§Ø± ğŸš€
"""

def get_response(user_message: str, history: List[Dict]) -> str:
    try:
        chat = model.start_chat(
            history=[
                {"role": "user",  "parts": [{"text": SYSTEM_PROMPT}]},
                {"role": "model", "parts": [{"text": "Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø§Ù†Ø§ Ù…Ø­Ù…Ø¯ Ù†Ø¬Ù…Ø§Ù† ÙƒÙŠÙ Ø£Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„ÙŠÙˆÙ… ÙÙŠ Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø¹Ù…Ø§Ù„ØŸ"}]},
                *history
            ]
        )
        resp = chat.send_message(user_message)
        return resp.text
    except Exception as e:
        print(f"Error communicating with Gemini: {e}")
        return "Ø¹Ø°Ø±Ù‹Ø§ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙ†ÙŠ. Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ù‹Ø§."

# (ØªØ¹Ø¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯) ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„ÙŠØ¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„ÙˆÙŠØ¨
@app.get("/")
async def read_index():
    # Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ø±Ø¬Ø§Ø¹ Ø±Ø³Ø§Ù„Ø©ØŒ Ø³ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø¢Ù† Ø¨Ø¥Ø±Ø¬Ø§Ø¹ Ù…Ù„Ù index.html Ù…Ù† Ù…Ø¬Ù„Ø¯ frontend
    return FileResponse('frontend/index.html')


@app.post("/chat")
def chat(request: ChatRequest):
    if not request.message.strip():
        raise HTTPException(status_code=400, detail="Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙØ§Ø±ØºØ©")

    history_for_gemini = [
        {"role": part.role, "parts": [{"text": p["text"]}]}
        for part in request.history for p in part.parts
    ]

    bot_text = get_response(request.message, history_for_gemini)

    updated_history = history_for_gemini + [
        {"role": "user",  "parts": [{"text": request.message}]},
        {"role": "model", "parts": [{"text": bot_text}]}
    ]

    return {
        "bot_response": bot_text,
        "updated_history": updated_history
    }











#
# import os
# from fastapi import FastAPI, HTTPException
# from fastapi.middleware.cors import CORSMiddleware
# from pydantic import BaseModel, Field
# from typing import List, Dict
# from dotenv import load_dotenv
# import google.generativeai as genai
#
# # ØªØ­Ù…ÙŠÙ„ Ù…ÙØªØ§Ø­ API Ù…Ù† .env
# load_dotenv()
# api_key = os.getenv("GEMINI_API_KEY")
# if not api_key:
#     raise ValueError("ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ù…ÙØªØ§Ø­ Gemini API ÙÙŠ Ù…Ù„Ù .env")
#
# # ØªÙ‡ÙŠØ¦Ø© Gemini Flash 2.5
# genai.configure(api_key=api_key)
# model = genai.GenerativeModel("gemini-2.5-flash")
#
# # Ø¥Ø¹Ø¯Ø§Ø¯ FastAPI Ù…Ø¹ CORS
# app = FastAPI(
#     title="Business Management Tutor API",
#     description="Ø´Ø§Øª Ø¨ÙˆØª Ù…ØªØ®ØµØµ ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ØŒ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©ØŒ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ØŒ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ØŒ ÙˆØ§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©",
#     version="1.0.0"
# )
# app.add_middleware(
#     CORSMiddleware,
#     allow_origins=["*"],
#     allow_credentials=True,
#     allow_methods=["*"],
#     allow_headers=["*"],
# )
#
# # ØªØ¹Ø±ÙŠÙ Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
# class HistoryPart(BaseModel):
#     role: str              # "user" Ø£Ùˆ "model"
#     parts: List[Dict[str,str]]
#
# # Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø·Ù„Ø¨: Ø±Ø³Ø§Ù„Ø© + Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
# class ChatRequest(BaseModel):
#     message: str
#     history: List[HistoryPart] = Field(default_factory=list)
#
#
# SYSTEM_PROMPT = """
# Ø£Ù†Ø§ Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ù…Ø­Ù…Ø¯ Ù†Ø¬Ù…Ø§Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ ğŸ’¼ğŸ¤ Ù…Ø³Ø§Ø¹Ø¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø°ÙƒÙŠ!
# ğŸ¯ Ù…Ù‡Ø§Ù…ÙŠ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:
# 1. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…ØªØ¹Ù„Ù‚ Ø¨Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ (Ù…ÙØ§Ù‡ÙŠÙ…ØŒ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§ØªØŒ Ø¯Ø±Ø§Ø³Ø§Øª Ø­Ø§Ù„Ø©ØŒ Ø£Ù…Ø«Ù„Ø© Ø¹Ù…Ù„ÙŠØ©ØŒ Ù…Ø´Ø§ÙƒÙ„ ÙˆØ­Ù„ÙˆÙ„ØŒ Ø®Ø·Ø· ØªØ·ÙˆÙŠØ±ØŒ ØªØ³ÙˆÙŠÙ‚ØŒ ØªÙ…ÙˆÙŠÙ„ØŒ Ø±ÙŠØ§Ø¯Ø© Ø£Ø¹Ù…Ø§Ù„...):
#    â†’ Ø£Ø´Ø±Ø­ Ø§Ù„Ù…ÙÙ‡ÙˆÙ… Ø¨Ø·Ø±ÙŠÙ‚Ø© ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ø¨Ø³Ø·Ø©
#    â†’ Ø£Ù‚Ø¯Ù‘Ù… Ø£Ù…Ø«Ù„Ø© Ø¹Ù…Ù„ÙŠØ© Ù…Ù† Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø£Ùˆ Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ§Øª
#    â†’ Ø£Ø·Ø±Ø­ Ù†ØµØ§Ø¦Ø­ ÙˆØ®Ø·ÙˆØ§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
#    â†’ Ø£Ø±Ø¨Ø· Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø¨Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„Ø§Ù‚ØªØµØ§Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
#    â†’ Ø£Ø³Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ø£Ùˆ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© Ø¨Ø®Ø·ÙˆØ§Øª Ø¹Ù…Ù„ÙŠØ©
#    â†’ Ø£Ù‚Ø¯Ù‘Ù… Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù„Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù…Ù‡Ù†ÙŠÙŠÙ† ÙˆØ±ÙˆØ§Ø¯ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„
#    â†’ Ø£Ù„Ø®Øµ Ø§Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ù†Ø¸Ø±ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ø¥Ø°Ø§ Ø·ÙÙ„Ø¨ Ø°Ù„Ùƒ
#    â†’ Ø£Ø¹ÙŠØ¯ ØµÙŠØ§ØºØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø£Ø¨Ø³Ø· Ø¥Ø°Ø§ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø°Ù„Ùƒ (ØªØ¨Ø³ÙŠØ· ğŸ”)
#    â†’ Ø£Ù‚Ø¯Ù‘Ù… Ù…Ù„Ø®ØµØ§Øª Ø³Ø±ÙŠØ¹Ø© Ø£Ùˆ Ù†Ù‚Ø§Ø· Ø£Ø³Ø§Ø³ÙŠØ© Ø¹Ù†Ø¯ Ø·Ù„Ø¨ "ØªÙ„Ø®ÙŠØµ âœï¸"
#    â†’ Ø£Ù‚Ø§Ø±Ù† Ø¨ÙŠÙ† Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø£Ùˆ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø¥Ø°Ø§ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… "Ù…Ù‚Ø§Ø±Ù†Ø© âš–ï¸"
#    â†’ Ø£Ø¹Ø¯Ù‘ Ø®Ø·Ø© Ø¹Ù…Ù„ ÙƒØ§Ù…Ù„Ø© (Business Plan) Ø¥Ø°Ø§ Ø·ÙÙ„Ø¨ Ø°Ù„Ùƒ ğŸ“Š
#    â†’ Ø£Ù‚ØªØ±Ø­ Ø£ÙÙƒØ§Ø± Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙ…Ø¨ØªÙƒØ±Ø© ğŸš€
#    â†’ Ø£Ø¬Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ SWOT Ù„Ø£ÙŠ Ù…Ø´Ø±ÙˆØ¹ Ø£Ùˆ Ù…Ø¤Ø³Ø³Ø© ğŸ§©
#    â†’ Ø£Ù‚Ø¯Ù‘Ù… Ø®Ø·Ø· ØªØ³ÙˆÙŠÙ‚ ÙˆØ§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³ÙˆÙ‚ ğŸ“ˆ
#    â†’ Ø£ØµÙ…Ù… Ø®Ø·ÙˆØ§Øª Ù„Ø­Ù„ Ù…Ø´Ø§ÙƒÙ„ ÙˆØ§Ù‚Ø¹ÙŠØ© Ù…Ø¹ Ø§Ù‚ØªØ±Ø§Ø­ Ø¨Ø¯Ø§Ø¦Ù„ Ø¹Ù…Ù„ÙŠØ© ğŸ”§
#    â†’ Ø£ØªØ°ÙƒØ± Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙˆØ£Ø±Ø¨Ø· Ø¨ÙŠÙ†Ù‡Ø§ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…ØªØ±Ø§Ø¨Ø·Ø© ÙˆØ´Ø§Ù…Ù„Ø©
# ğŸ“Œ Ù‚ÙˆØ§Ø¹Ø¯ Ø®Ø§ØµØ© Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:
# 1. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø³Ø¤Ø§Ù„ Ù…ØªØ§Ø¨Ø¹Ø© (ØªØ±Ø¬Ù…Ø©ØŒ ØªØ¨Ø³ÙŠØ·ØŒ ØªÙˆØ¶ÙŠØ­ØŒ Ø£Ùˆ Ø¥Ø´Ø§Ø±Ø©):
#    - Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ ØªÙ„Ø¨ÙŠØ© Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
#    - Ù„Ø§ ØªØ±Ø¯ Ø£Ø¨Ø¯Ø§Ù‹ Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØºÙŠØ± ÙƒØ§ÙÙŠØ© Ù„Ù…Ø«Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
#    - Ù„Ù„ØªØ±Ø¬Ù…Ø©: Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£ØµÙ„ÙŠ Ù…Ø¹ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© ÙÙ‚Ø·
#    - Ù„Ù„ØªÙˆØ¶ÙŠØ­: Ù‚Ø¯Ù… Ù…Ø²ÙŠØ¯Ø§Ù‹ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø­ÙˆÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
#    - Ù„Ù„ØªØ¨Ø³ÙŠØ·: Ø­Ø¯Ø¯ Ù…Ø§ ÙŠØ³Ø¨Ø¨ Ø§Ù„Ù„Ø¨Ø³ ÙˆÙØ³Ù‘Ø±Ù‡ Ø¨Ø¯Ù„ÙŠÙ„
#    - Ù„Ù„ØªÙ„Ø®ÙŠØµ: Ù‚Ø¯Ù‘Ù… Ù†Ù‚Ø§Ø·Ø§Ù‹ Ù…Ø±ÙƒØ²Ø© ØªÙØºÙ†ÙŠ Ø¹Ù† Ø§Ù„Ø´Ø±Ø­ Ø§Ù„Ø·ÙˆÙŠÙ„
# 2. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø³Ø¤Ø§Ù„Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹:
#    - Ø§Ø¹ØªÙ…Ø¯ ÙÙŠ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
#    - Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø°Ø§Øª ØµÙ„Ø©ØŒ Ø§Ø°ÙƒØ± Ø°Ù„Ùƒ Ø¨ÙˆØ¶ÙˆØ­
#    - Ø§Ø±Ø¨Ø· Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù‚ØªØ¶Ø§Ø¡
# 3. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ·Ù„Ø¨ Ù…Ù‚Ø§Ø±Ù†Ø©:
#    - Ù‚Ø¯Ù‘Ù… Ø¬Ø¯ÙˆÙ„/Ù†Ù‚Ø§Ø· Ù…Ù†Ø¸Ù…Ø©
#    - ÙˆØ¶Ù‘Ø­ Ø£ÙˆØ¬Ù‡ Ø§Ù„ØªØ´Ø§Ø¨Ù‡ ÙˆØ§Ù„Ø§Ø®ØªÙ„Ø§Ù ÙˆØªØ£Ø«ÙŠØ±Ù‡Ø§ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ
# 4. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ·Ù„Ø¨ Ø®Ø·Ø© Ø¹Ù…Ù„ÙŠØ©:
#    - Ù‚Ø¯Ù‘Ù… Ø®Ø·ÙˆØ§Øª Ù…Ø±ØªØ¨Ø© Ø¨Ø²Ù…Ù†/Ù…Ù†Ø·Ù‚
#    - Ø§Ø±Ø¨Ø· ÙƒÙ„ Ø®Ø·ÙˆØ© Ø¨Ù‡Ø¯Ù Ø¥Ø¯Ø§Ø±ÙŠ ÙˆØ§Ø¶Ø­
#    - Ø£Ø¶Ù Ø£Ø¯ÙˆØ§Øª Ø£Ùˆ Ø£Ù…Ø«Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø©
# 5. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø¤Ø§Ù„ ØºÙŠØ± Ù…ØªØ¹Ù„Ù‚ Ø¨Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„:
#    â†’ Ø£Ø¬Ø¨ ÙÙ‚Ø·: "Ø¹Ø°Ø±Ù‹Ø§ ğŸ˜ŠØŒ Ø£Ù†Ø§ Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ù†Ø¬Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ ğŸ’¼ØŒ Ù…ØªØ®ØµØµ ÙÙ‚Ø· ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„!"
# ğŸ“ Ø§Ù„Ø£Ø³Ù„ÙˆØ¨:
# - Ù„ØºØ© Ù…Ø¨Ø³Ø·Ø© ÙˆÙˆØ§Ø¶Ø­Ø© + Ù†Ù‚Ø§Ø· Ù…Ù†Ø¸Ù…Ø© + Ø£Ù…Ø«Ù„Ø© ÙˆØ§Ù‚Ø¹ÙŠØ© + Ù†ØµØ§Ø¦Ø­ Ø¹Ù…Ù„ÙŠØ©
# - Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ: Ù†Ø¸Ø±ÙŠØ§Øª ÙˆÙ…Ø±Ø§Ø¬Ø¹ / Ø¹Ù…Ù„ÙŠ: Ø®Ø·ÙˆØ§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
# - Ø§Ù„ØªÙƒÙŠÙ‘Ù Ù…Ø¹: ØªÙ„Ø®ÙŠØµ âœï¸ØŒ ØªØ¨Ø³ÙŠØ· ğŸ”ØŒ Ù…Ù‚Ø§Ø±Ù†Ø© âš–ï¸ØŒ Ø®Ø·Ø© Ø¹Ù…Ù„ ğŸ“ŠØŒ SWOT ğŸ§©ØŒ Ø£ÙÙƒØ§Ø± ğŸš€
# """
# def get_response(user_message: str, history: List[Dict]) -> str:
#     """
#     ÙŠØ±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ù…Ø¹ ÙƒØ§Ù…Ù„ history Ø¥Ù„Ù‰ Gemini Flash 2.5 ÙˆÙŠØ¹ÙŠØ¯ Ø§Ù„Ù†Øµ Ø§Ù„Ù†Ø§ØªØ¬.
#     """
#     try:
#         # Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù„Ø³Ø© Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© SYSTEM_PROMPT ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
#         chat = model.start_chat(
#             history=[
#                 {"role": "user",  "parts": [{"text": SYSTEM_PROMPT}]},
#                 {"role": "model", "parts": [{"text": "Ù…Ø±Ø­Ø¨Ù‹Ø§! ÙƒÙŠÙ Ø£Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„ÙŠÙˆÙ… ÙÙŠ Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø¹Ù…Ø§Ù„ØŸ"}]},
#                 *history
#             ]
#         )
#         resp = chat.send_message(user_message)
#         return resp.text
#     except Exception as e:
#         print(f"Error communicating with Gemini: {e}")
#         return "Ø¹Ø°Ø±Ù‹Ø§ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙ†ÙŠ. Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ù‹Ø§."
#
# @app.get("/")
# def root():
#     return {"status": "Business Management Tutor API is running"}
#
# @app.post("/chat")
# def chat(request: ChatRequest):
#     # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø© ØºÙŠØ± ÙØ§Ø±ØºØ©
#     if not request.message.strip():
#         raise HTTPException(status_code=400, detail="Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙØ§Ø±ØºØ©")
#
#     # ØªØ­ÙˆÙŠÙ„ Pydantic history Ø¥Ù„Ù‰ Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
#     history_for_gemini = [
#         {"role": part.role, "parts": [{"text": p["text"]}]}
#         for part in request.history for p in part.parts
#     ]
#
#     # Ø¬Ù„Ø¨ Ø§Ù„Ø±Ø¯ Ù…Ù† Gemini
#     bot_text = get_response(request.message, history_for_gemini)
#
#     # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„
#     updated_history = history_for_gemini + [
#         {"role": "user",  "parts": [{"text": request.message}]},
#         {"role": "model", "parts": [{"text": bot_text}]},
#         {"role": "model", "parts": [{"text": "Ù…Ø±Ø­Ø¨Ù‹Ø§! ÙƒÙŠÙ Ø£Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„ÙŠÙˆÙ… ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ØŸ"}]}
#     ]
#
#     return {
#         "bot_response": bot_text,
#         "updated_history": updated_history
#     }
